# 实验六 索引与触发器
## 实验目的
- 掌握创建索引的基本方法
- 熟悉复合索引、唯一索引的基本概念
- 掌握触发器的含义和作用
- 掌握触发器的使用方法

## 实验步骤
### 索引的操作
1. 使用Create Index语句创建索引  
- 对school数据库的student表中的sname列建立索引  
- 在school表的sname列和saddress列上建立复合索引  
- 对course表上的cname列建立唯一性索引

2. 使用Alter Table语句向表中添加索引
- 向student表中的sbirth列添加一个唯一性索引  

3. 在创建表时创建索引
- 创建与course表相同结构的表course1，将cname设为主键，cno建立一个索引。  

4. 删除索引
- 使用Drop Index语句删除表course上的索引  
- 使用Alter Table语句删除course1上的主键和索引

### 触发器的操作
1. 创建logger表（表结构如下表所示），记录student表操作记录的相关信息  
logger表

|字段名|数据类型|完整性约束条件|
|--|--|--|
|lno| int| 主键，自增|
|ltime|datetime |非空|
|loperation|char(10)||

2. 创建触发器，在student表中删除学生信息的同时将sc表中该学生的信息删除，以确保数据完整性。
3. 创建触发器，在course表中删除课程信息的同时将sc表中该课程的信息删除，以确保数据完整性。
4. 假设course2表和course表的结构和内容都相同，在course上创建一个触发器，如果添加一门课程，该课程信息也会添加到course2表中。

## 实验代码
### 
1. 使用Create Index语句创建索引  
- 对school数据库的student表中的sname列建立索引  
```
create index idx_1 on student(sname);
```
- 在school表的sname列和saddress列上建立复合索引
```
create index idx_2 on student(sname,saddress);
```
- 对course表上的cname列建立唯一性索引
```
create unique index idx_3 on course(cname);
```

2. 使用Alter Table语句向表中添加索引
- 向student表中的sbirth列添加一个唯一性索引 
```
alter table student add unique index idx_4(sbirth);
```

3. 在创建表时创建索引
- 创建与course表相同结构的表course1，将cname设为主键，cno建立一个索引。  
```
create table course1
(
    cno char(6),
    cname char(3) not null,
    ccredit tinyint default 3,
    primary key(cname),
    index idx_5(cno)
);
```

4. 删除索引
- 使用Drop Index语句删除表course上的索引  
```
drop index idx_3 on course;
```
- 使用Alter Table语句删除course1上的主键和索引
```
alter table course1 drop primary key,drop index idx_5;
```

***
### 触发器
1. 创建logger表（表结构如下表所示），记录student表操作记录的相关信息  
```
Create trigger trig_1 after delete on student for each row  insert into logger(ltime,loperation) values(now(),’delete’);
Create trigger trig_2 after insert on student for each row  insert into logger(ltime,loperation) values(now(),’insert’);
Create trigger trig_3 after update on student for each row insert into logger(ltime,loperation)values(now(),’update’);
```
2. 创建触发器，在student表中删除学生信息的同时将sc表中该学生的信息删除，以确保数据完整性。
```
Delimiter &&
Create procedure pro_1(in xuehao char(10))
Begin
Set @a=xuehao;
Delete from student where sno=xuehao;
End &&
Delimiter ;
Create trigger trig_4 before delete on student
For each row
Delete from sc where sno=@a;
Call pro_1(‘2018001’);
```
4. 假设course2表和course表的结构和内容都相同，在course上创建一个触发器，如果添加一门课程，该课程信息也会添加到course2表中。
```
Delimiter &&
Create procedure pro_2(in cno char(8),in cname char(8),in credit tinyint)
    begin
     @a=cno;@b=cname;@c=credit;
      insert into course values(cno,cname,credit);
    end &&
    delimiter ;
    create trigger trig_5 after insert on course
    for each row
    insert into course2 values(@a,@b,@c);
```